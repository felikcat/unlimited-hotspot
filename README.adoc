:experimental:
:imagesdir: Pictures/
ifdef::env-github[]
:icons:
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
endif::[]

:toc:

== About
[.lead]
Compared to other solutions such as PDANet, FoxFi, NetShare, EasyTether, Wi-Fi Tether Router, TetherMe, iTether, MyWi, and iPhoneModem:

. This guide supports hotspots from *Android* phones and tablets, *iOS*, *iPadOS*, and *Quectel* modems.
. The methods provide high performance and reliability, unlike SSH tunneling.

. It is fully open-source and free.
- Exception: The iOS and iPadOS method is not open-source but remains free.

. On "unlimited" telecom plans, it provides unlimited hotspot data by not being classified as hotspot data.

. It bypasses various throttling types, such as reduced video quality on YouTube or other streaming services.

. Allows for 6GHz WiFi tethering on some rooted Android devices, where it would otherwise be blocked.

== Hosting an Unlimited Hotspot

.Quectel and Rooted Android are the best methods available.
- For rooted Android the OS used on most devices that's high-quality is https://lineageos.org/[LineageOS].
** After installing the OS, sideload/flash a kernel that contains "KernelSU Next" and "TTL/HL mangling", such as https://github.com/engstk/gs/releases[blu_spark] for Google Pixel 6/7/8/9 phones. Avoid Magisk or KernelSU.
** To install the KernelSU Next app, go to the latest release https://github.com/KernelSU-Next/KernelSU-Next/releases/[here], click "Show all assets", then scroll all the way down until the .apk file is found and install that.

.Quectel modems
[%collapsible]
====

CAUTION: Do not spoof an IMEI from a device you do not own. This is illegal in the United States and may block the original device if it uses the same telecom provider.

.Spoof the Quectel modem's IMEI to match a phone or tablet you own with mobile data:
* `AT+EGMR=1,7,"The IMEI here"`

====

.*iOS* and *iPadOS*
[%collapsible]
====
. https://pairvpn.com/install[Install PairVPN] from the App Store on the iOS or iPadOS device and on client devices (such as a Windows laptop).

. Connect the client to your iOS/iPadOS device using its "Mobile Hotspot" or USB tethering.

. Run PairVPN as a server on the iOS/iPadOS device, then connect clients using the PairVPN app.
- While PairVPN is active, hotspot data usage will not be counted.
- Enable "Share Location" to allow PairVPN to run in the background continuously, and permit notifications.

====

.Non-rooted *Android*
[%collapsible]
====

GrapheneOS doesn't require TetherFi; turn on regular hotspot tethering instead.

. https://github.com/pyamsoft/tetherfi#tetherfi[Install TetherFi] on the Android device.

. Open the TetherFi app.

. In the "Hotspot" tab, configure these settings:
- Broadcast frequency: 5GHz
- Enable all Wake Locks
- Enable: Bind Proxy to All Interfaces

. Follow the instructions in the "How To" tab.

====

.Rooted *Android*
[%collapsible]
====
. Download the https://github.com/felikcat/unlimited-hotspot/releases/download/v9/unlimited-hotspot-v9.zip[Unlimited Hotspot] Magisk/KernelSU/KernelSU Next module.

. In Magisk/KernelSU/KernelSU Next app, go to Modules, select Install from storage, and choose the downloaded "unlimited-hotspot-v9.zip".

. Reboot.

====

== Bypassing Throttling and Restrictions

TIP: The PairVPN method supports VPN use on the host iOS/iPadOS device, which extends to connected clients. The TetherFi method also supports VPNs but requires one that uses a proxy, such as AirVPN.

NOTE: https://airvpn.org/[AirVPN] supports torrenting with full port forwarding. +
https://mullvad.net[Mullvad] offers the highest speeds. +
https://www.mysteriumvpn.com/[Mysterium] provides residential IPs for services that block VPNs. +
https://www.mysteriumdark.com/[Mysterium Dark] charges by data usage, while https://www.mysteriumvpn.com/[Mysterium] uses a subscription model.

WARNING: Anti-DPI software are not for countries where evading their censorship is legally dangerous, and will not enhance privacy. Use a quality VPN provider instead like Mullvad if you need it.

.Install anti-DPI software for each operating system; every client needs its own anti-DPI software:

* FreeBSD, OpenBSD: https://github.com/bol-van/zapret/blob/master/docs/bsd.en.md[zapret].

* macOS: https://github.com/krlvm/PowerTunnel#configuring[PowerTunnel] or https://github.com/xvzc/SpoofDPI[SpoofDPI]. +
https://github.com/bol-van/zapret/blob/master/docs/readme.en.md[zapret] is available but challenging to use on Apple silicon macOS (use its https://github.com/bol-van/zapret/blob/master/docs/bsd.en.md[BSD instructions]).
* Linux: https://github.com/xvzc/SpoofDPI[SpoofDPI] or https://github.com/Kkevsterrr/geneva[Geneva].
* Windows: https://github.com/ValdikSS/GoodbyeDPI[GoodbyeDPI] or https://github.com/macronut/ghostcp[GhosTCP].
* Android: https://github.com/dovecoteescapee/ByeDPIAndroid[ByeDPI]; use in VPN mode.
* iOS/iPadOS: https://apps.apple.com/in/app/1-1-1-1-faster-internet/id1423538627[Cloudflare's 1.1.1.1 app]; other WireGuard or OpenVPN-based VPNs also work.

.How to use Geneva on Debian Linux 13
[%collapsible]
====

. `git clone https://github.com/Kkevsterrr/geneva`
. `cd geneva`

. `sudo apt install build-essential python-dev-is-python3 libnetfilter-queue-dev libffi-dev libssl-dev iptables python3-pip python3.13-venv`

. A virtual Python environment will be used to keep the system clean: +
`python3 -m venv venv`
. `venv/bin/pip3 install -r requirements.txt`
. `venv/bin/pip3 install --upgrade scapy`

. Now you can run Geneva how you'd like, for example to intercept ports 80 and 443 (HTTP and HTTPS web traffic) and do minimalist intervention only: +
`sudo venv/bin/python3 engine.py --server-port "80,443" --strategy "[TCP:flags:PA]-tamper{TCP:chksum:corrupt},),)-|" --log debug`

. When you are done using Geneva, drop all the iptables rules using: `sudo iptables -F`

====

.How to use PowerTunnel on macOS
[%collapsible]
====

. Make sure the https://github.com/krlvm/PowerTunnel/releases[latest PowerTunnel.jar] is downloaded.

. Download and install the https://adoptium.net/download/[Adoptium Temurin installer].

. After installation, in Finder, hold kbd:[Option] and right-click PowerTunnel.jar, then select "Open". +
image:kbmagic.jpeg[]

. image:settings_powertunnel.png[]

====

=== Additional required steps

.HTTPS "packet chunking" (also called TCP fragmentation) is required to bypass throttling.
[%collapsible]
====

. image:PowerTunnel1.png[480,360]
. Set a low chunk size, such as "1": + 
image:PowerTunnel2.png[480,360]

====

.If using PowerTunnel and TetherFi (for non-rooted Android).
[%collapsible]
====

. In PowerTunnel, go to "Options".
. Set the upstream proxy to match TetherFi's settings. For example, 192.168.49.1 on port 8228 for HTTP/HTTPS.
- image:PowerTunnel3.png[480,360]

====

.macOS
[%collapsible]
====
. https://github.com/felikcat/unlimited-hotspot/archive/refs/heads/main.zip[Download Unlimited Hotspot], then extract "unlimited-hotspot-main.zip" in Finder.
. Open the "unlimited-hotspot-main" folder, then the "macOS" folder.
. Open Terminal.

. Type `sudo -i`, enter your password, and press Enter.
. Type `cp`, drag `set-ios-tcp-stack.sh` into the terminal, press Space, type `/var/root`, and press Enter.
. Type `cp`, drag `felikcat.set.ios.tcpstack.plist` into the terminal, press Space, type `/Library/LaunchDaemons`, and press Enter.
. `chmod +x /var/root/set-ios-tcp-stack.sh`
. If your router or phone already increases the TTL of all its clients by 1, edit `/Library/LaunchDaemons/felikcat.set.ios.tcpstack.plist` and remove the following lines:
- `${SYSCTL} -w net.inet.ip.ttl=65`
- `${SYSCTL} -w net.inet6.ip6.hlim=65`
. `launchctl load -w /Library/LaunchDaemons/felikcat.set.ios.tcpstack.plist`

'''
====

=== Routers
For Quectel modems or hotspots connected to a router, follow these steps:

.Asuswrt-Merlin
[%collapsible]
====
. In Advanced Settings - WAN, disable `Extend the TTL value` and `Spoof LAN TTL value`.
. In Advanced Settings - Administration:
- Enable JFFS custom scripts and configs: "Yes"
- Enable SSH: "LAN only"
. SSH to the router, replacing IP and username if needed: `$ ssh 192.168.50.1 -l asus`
- Use SSH clients like MobaXterm or Termius if preferred.
. `# nano /jffs/scripts/wan-event`

[source, shell]
----
#!/bin/sh
# shellcheck disable=SC2068
Say() {
  printf '%s%s' "$$" "$@" | logger -st "($(basename "$0"))"
}
WAN_IF=$1
WAN_STATE=$2

# Call appropriate script based on script_type
SERVICE_SCRIPT_NAME="wan${WAN_IF}-${WAN_STATE}"
SERVICE_SCRIPT_LOG="/tmp/WAN${WAN_IF}_state"

# Execute and log script state
if [ -f "/jffs/scripts/${SERVICE_SCRIPT_NAME}" ]; then
  Say "     Script executing.. for wan-event: $SERVICE_SCRIPT_NAME"
  echo "$SERVICE_SCRIPT_NAME" >"$SERVICE_SCRIPT_LOG"
  sh /jffs/scripts/"${SERVICE_SCRIPT_NAME}" "$@"
else
  Say "     Script not defined for wan-event: $SERVICE_SCRIPT_NAME"
fi

##@Insert##
----

`# nano /jffs/scripts/wan0-connected`
[source, shell]
----
#!/bin/sh

# HACK: I am unsure of what to check.
## Do this too early and the TTL & HL won't be set.
sleep 5s; modprobe xt_HL; wait

# Removes these iptables entries if present.
# WARNING: Only removes these entries once, and never assumes the same entries are present twice.
iptables -t mangle -D PREROUTING -i usb+ -j TTL --ttl-inc 2
iptables -t mangle -D POSTROUTING -o usb+ -j TTL --ttl-inc 2
ip6tables -t mangle -D PREROUTING ! -p icmpv6 -i usb+ -j HL --hl-inc 2
ip6tables -t mangle -D POSTROUTING ! -p icmpv6 -o usb+ -j HL --hl-inc 2

# Move past TTL & HL hotspot detections.
## Increments the TTL & HL by 2 (1 for the router, 1 for the devices connected to the router).
iptables -t mangle -A PREROUTING -i usb+ -j TTL --ttl-inc 2
iptables -t mangle -I POSTROUTING -o usb+ -j TTL --ttl-inc 2
ip6tables -t mangle -A PREROUTING ! -p icmpv6 -i usb+ -j HL --hl-inc 2
ip6tables -t mangle -I POSTROUTING ! -p icmpv6 -o usb+ -j HL --hl-inc 2
----
Now, set permissions to avoid the error: `custom_script: Found wan-event, but script is not set executable!` +
`# chmod a+rx /jffs/scripts/*` +
`# reboot`

====

.GoldenOrb
[%collapsible]
====
Copy these TTL settings: +
image:firefox_wsJ71hUwXh.png[] +
image:firefox_lnpySSfHOt.png[]

====

.OpenWrt
[%collapsible]
====
. Go to `Network` -> `Firewall` -> `Custom Rules`
[source, shell]
----
# Removes these iptables entries if present; only removes once, so if the same entry is present twice (script assumes this never happens), it would need to be removed twice.
iptables -t mangle -D PREROUTING -i usb+ -j TTL --ttl-inc 2
iptables -t mangle -D POSTROUTING -o usb+ -j TTL --ttl-inc 2
ip6tables -t mangle -D PREROUTING ! -p icmpv6 -i usb+ -j HL --hl-inc 2
ip6tables -t mangle -D POSTROUTING ! -p icmpv6 -o usb+ -j HL --hl-inc 2

# Move past TTL & HL hotspot detections.
## Increments the TTL & HL by 2 (1 for the router, 1 for the devices connected to the router).
iptables -t mangle -A PREROUTING -i usb+ -j TTL --ttl-inc 2
iptables -t mangle -I POSTROUTING -o usb+ -j TTL --ttl-inc 2
ip6tables -t mangle -A PREROUTING ! -p icmpv6 -i usb+ -j HL --hl-inc 2
ip6tables -t mangle -I POSTROUTING ! -p icmpv6 -o usb+ -j HL --hl-inc 2
----

====

== Configuring dnscrypt2 to Bypass Webpage Blocks

TIP: Unnecessary if using a VPN or certain anti-DPI software; test to confirm.

https://github.com/DNSCrypt/dnscrypt-proxy/wiki/Installation[Installation instructions for other OSes], such as Windows, Linux, etc.

.macOS
[%collapsible]
====
. Visit https://ipleak.net/[AirVPN's IP Leak] page to note your current DNS servers. Take a screenshot.

. https://brew.sh/[Install Homebrew] if not already done.

. Run `brew install dnscrypt-proxy`

. Follow Brew's post-installation information.
- Install dnscrypt-proxy's service as recommended.

. In Settings, go to Network, select your current interface (e.g., "USB 10/100/1G/2.5G LAN").
. Click "Details..." +
image:settings_dnscrypt.png[]
. In DNS, add `127.0.0.1` using the Plus (+) button. +
image:settings_dnscrypt_2.png[]

. Revisit https://ipleak.net/[AirVPN's IP Leak] page to verify DNS changes; compare with your screenshot.

====

== Verifying Throttling Bypass

* Use https://fast.com[Netflix's Speedtest], then compare with https://www.waveform.com/tools/bufferbloat[Waveform's Bufferbloat Test]. +
- This checks for throttling on streaming (Netflix), data fingerprinting, and hotspot detections.

== Optimizing Internet Speeds

.*Android only* -> Enable Data Saver:
* Works only via USB, as it blocks wireless hotspots.
- Data Saver restricts data to USB hotspot and foreground app.

.*Android & iOS/iPadOS & Quectel* -> Disable roaming:
* In Settings, search for "Roaming" and disable it.
- Roaming often throttles; e.g., T-Mobile USA roams on AT&T at 250kbps.

.*Android & iOS/iPadOS & Quectel* -> Switch cell towers in problematic areas
* *Android*: Settings -> Network & internet -> SIMs -> Disable "Automatically select network"
* *iOS*: For T-Mobile, Sprint towers may offer better speeds. +
image:ios_network_selection.PNG[width=281.5,height=305]

.*Rooted Android & Quectel* -> Use specific 4G, LTE, 5G NA, or 5G SA bands:
* *Rooted Android*:
. Install https://apkpure.com/netmonster/cz.mroczis.netmonster[NetMonster] for network monitoring.

. Install https://apkpure.com/network-signal-guru/com.qtrun.QuickTest[Network Signal Guru], set allowed LTE bands to "LTE 4x4 Bands" from https://cacombos.com/device/G025E[cacombos.com] for your device. This may stabilize or increase speeds.

. For ads, enable Systemless Hosts in Magisk, install https://github.com/AdAway/AdAway/releases[AdAway] using Root method (not VPN).

.*Android only* -> Disable "hotspot hardware acceleration" in Settings:
- Only if experiencing high ping or spikes; otherwise, keep enabled.

== Appendices

.Learning resources
[%collapsible]
====

. https://archive.org/download/p173_20220313/p173.pdf
. https://archive.org/download/technology-showcase-policy-control-for-connected-and-tethered-devices/technology-showcase-policy-control-for-connected-and-tethered-devices.pdf
. https://archive.org/download/geneva_ccs19/geneva_ccs19.pdf
. https://incolumitas.com/2021/03/13/tcp-ip-fingerprinting-for-vpn-and-proxy-detection/
. https://github.com/NikolaiT/zardaxt
. https://blog.cloudflare.com/optimizing-tcp-for-high-throughput-and-low-latency/
. Demonstrated bypassing hotspot classification on non-jailbroken iOS/iPadOS via ad-hoc Wi-Fi and proxy: https://blog.cyrusroshan.com/post/phone-data-hotspot

[.lead]
Third-party scripts

. The `/jffs/scripts/wan-event` for Asuswrt-Merlin is a refined version of https://www.snbforums.com/threads/wan-start-script-also-run-on-wan-stop.61295/#post-542636[this script].

====

*You've reached the end of this guide.* Star it if you liked it. Be sure to donate to TetherFi or other projects you rely on.

'''
